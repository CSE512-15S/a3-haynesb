{% extends "base.html" %}

{% block queries_active %} class="active"{% endblock %}

{% block extra_head %}
	<script src="js/d3.v3.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/colorbrewer.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/underscore-min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/d3.selection.popover.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/d3.selection.tooltip.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/chroma.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/graph.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/networkvis.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/fragmentvis.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/fragmentoverview.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/dagre-d3.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/viz.js" type="text/javascript" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" href="css/queryvis.css">
{% endblock %}

{% block extra_container_class %}my-fluid-container{% endblock %}

{% block content %}
    <div class="page-header">
  		<h1>Query {{ queryId }} <small>visualization of physical query execution</small></h1>
	</div>

	<p class="lead">
		This page shows a visualization of how query {{ queryId }} was executed. On the left, you can see the physical query plan which consists of operators that are grouped in fragments. Communication between fragments is over the network.

		You can click on a fragment to explore what happened inside a fragment and on a connection between fragments to explore then network communication.
	</p>

	<div class="row">
		<div class="col-md-5 col-lg-4">
			<div class="panel panel-default ">
				<div class="panel-heading">
			   		<h3 class="panel-title">Physical Query Plan:</h3>
			    </div>
				<div class="query-plan panel-body" data-type="line" data-query="{{ queryId }}"></div>
			</div>
		</div>
		<div class="col-md-7 col-lg-8">
			<div class="panel panel-default ">
				<div class="panel-heading">
			   		<h3 class="panel-title" id="title-right-vis"></h3>
			    </div>
				<div class="panel-body">
					<div class="chart"></div>
				</div>
			</div>
		</div>
	</div>

    <p>
		Use <a href="http://nytimes.github.io/svg-crowbar/">Crowbar</a> to download the images.
    </p>
{% endblock %}

{% block footer %}
	<script type="text/javascript">
		{% autoescape false %}
			var myriaConnection = '{{ myriaConnection }}';
			var queryPlan = {{ queryPlan }};
		{% endautoescape %}
		var queryPlan = {"profilingMode": true, "rawQuery": "Join Twitter", "startTime": "2014-03-03T22:30:13.507-08:00", "elapsedNanos": 5563498691, "queryId": 4, "logicalRa": "Join Twitter", "finishTime": "2014-03-03T22:30:19.071-08:00", "url": "http://vega.cs.washington.edu:8777/query/query-4", "submitTime": "2014-03-03T22:30:13.409-08:00", "status": "SUCCESS", "physicalPlan": {"profilingMode": true, "fragments": [{"operators": [{"opName": "Scan(R)", "relationKey": {"relationName": "TwitterSmall", "userName": "public", "programName": "adhoc"}, "opType": "TableScan", "storedRelationId": null}, {"argPf": {"index": 1, "type": "SingleFieldHash", "numPartitions": 8}, "argChild": "Scan(R)", "opName": "Shuffle(R)", "argBufferStateType": null, "opType": "ShuffleProducer"}], "fragmentIndex": 0, "workers": [1, 2, 3, 4, 5, 6, 7, 8]}, {"operators": [{"opName": "Scan(S)", "relationKey": {"relationName": "TwitterSmall", "userName": "public", "programName": "adhoc"}, "opType": "TableScan", "storedRelationId": null}, {"argPf": {"index": 0, "type": "SingleFieldHash", "numPartitions": 8}, "argChild": "Scan(S)", "opName": "Shuffle(S)", "argBufferStateType": null, "opType": "ShuffleProducer"}], "fragmentIndex": 1, "workers": [1, 2, 3, 4, 5, 6, 7, 8]}, {"operators": [{"opName": "GatherR", "argOperatorId": "Shuffle(R)", "opType": "ShuffleConsumer"}, {"opName": "GatherS", "argOperatorId": "Shuffle(S)", "opType": "ShuffleConsumer"}, {"argChild1": "GatherR", "argChild2": "GatherS", "argSetSemanticsLeft": false, "argColumns2": [0], "argColumns1": [1], "argSelect2": [1], "argSelect1": [0], "opName": "Join", "argColumnNames": null, "opType": "SymmetricHashJoin", "argSetSemanticsRight": false}, {"argChild": "Join", "opName": "SendResult", "opType": "CollectProducer"}], "fragmentIndex": 2, "workers": [6, 5, 7, 8, 2, 1, 3, 4]}, {"operators": [{"opName": "CollectResult", "argOperatorId": "SendResult", "opType": "CollectConsumer"}, {"indexes": null, "connectionInfo": null, "opName": "Insert", "opType": "DbInsert", "argOverwriteTable": true, "argChild": "CollectResult", "relationKey": {"relationName": "TwitterJoin", "userName": "public", "programName": "adhoc"}}], "fragmentIndex": 3, "workers": [1]}], "rawDatalog": "Join Twitter", "expectedResultSize": null, "logicalRa": "Join Twitter", "ftMode": "none"}};
	</script>
	<script type="text/javascript" src="js/queryvis.js" charset="utf-8" async defer></script>
{% endblock %}
