{% extends "base.html" %}

{% block extra_head %}
    <link rel="stylesheet" type="text/css" href="css/queryvis.css">
    <link href="css/codemirror.css" type="text/css" rel="stylesheet" />
{% endblock %}

{% block content %}
    <a name="query"></a>
    <div class="row">
        <div class="col-md-5 col-lg-4">
            <div class="panel panel-default ">
                <div class="panel-heading">
                    <h3 class="panel-title">Query</h3>
                </div>
                <div class="panel-body">
                    <p>
                        <pre>Triangle(x,y,z) :- Twitter(x,y), Twitter(y,z), Twitter(x,z)</pre>
                    </p>
                    <p>
                        <strong>Meaning:</strong> Compute triangles in Twitter social graph.
                    </p>
                </div>
                <div class="panel-body">
                    <div class="btn-group dropup">
                        <button type="button" id="plan-btn" class="planner btn btn-info">Compile to traditional plan</button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" title="Switch plan"><span class="caret"></span></button>
                        <ul id="plan-menu" class="dropdown-menu" role="menu">
                            <li><a class="changer">HyperCube plan</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-7 col-lg-8">
            <div class="panel panel-default ">
                <div class="panel-heading">
                    <h3 class="panel-title">Query Plan</h3>
                </div >
                <div class="panel-body">
                   <div class="query-plan panel-body" data-type="line" data-query="{{ queryId }}"></div >
                   <button type="button" class="executor btn btn-success">Execute the Query</button>
                </div>
            </div>
        </div>
    </div>
    <a name="result"></a>
    <div class="row">
    </div>

{% endblock %}

{% block footer %}
    <script src="js/d3.v3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/underscore-min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/d3.selection.popover.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/d3.selection.tooltip.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/graph.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/viz.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/queryvis.js" type="text/javascript" charset="utf-8"></script>

    <script type="text/javascript">
    {% autoescape false %}
        var myriaConnection = '{{ myriaConnection }}';
        var queryPlan = {{ queryPlan }};
    {% endautoescape %}

    var hyperCubePlan= {"url":"http://dbserver02.cs.washington.edu:10032/query/query-18","queryId":18,"rawQuery":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","logicalRa":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","physicalPlan":{"rawDatalog":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","logicalRa":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","fragments":[{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opName":"Scan(R)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"chushumo leapfrog twitter_10m\"          as a where a.follower<a.followee"},{"opType":"HyperShuffleProducer","opName":"shuffle_r","argChild":"Scan(R)","indexes":[0,1],"hyperCubeDimensions":[4,4,4],"cellPartition":[[0,1,2,3],[4,5,6,7],[8,9,10,11],[12,13,14,15],[16,17,18,19],[20,21,22,23],[24,25,26,27],[28,29,30,31],[32,33,34,35],[36,37,38,39],[40,41,42,43],[44,45,46,47],[48,49,50,51],[52,53,54,55],[56,57,58,59],[60,61,62,63]]}],"fragmentIndex":0},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opName":"Scan(S)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"chushumo leapfrog twitter_10m\""},{"opType":"HyperShuffleProducer","opName":"shuffle_s","argChild":"Scan(S)","indexes":[0,1],"hyperCubeDimensions":[4,4,4],"cellPartition":[[0,16,32,48],[1,17,33,49],[2,18,34,50],[3,19,35,51],[4,20,36,52],[5,21,37,53],[6,22,38,54],[7,23,39,55],[8,24,40,56],[9,25,41,57],[10,26,42,58],[11,27,43,59],[12,28,44,60],[13,29,45,61],[14,30,46,62],[15,31,47,63]]}],"fragmentIndex":1},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opName":"Scan(T)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"chushumo leapfrog twitter_10m\"          as a where a.follower>a.followee"},{"opType":"HyperShuffleProducer","opName":"shuffle_t","argChild":"Scan(T)","indexes":[1,0],"hyperCubeDimensions":[4,4,4],"cellPartition":[[0,4,8,12],[1,5,9,13],[2,6,10,14],[3,7,11,15],[16,20,24,28],[17,21,25,29],[18,22,26,30],[19,23,27,31],[32,36,40,44],[33,37,41,45],[34,38,42,46],[35,39,43,47],[48,52,56,60],[49,53,57,61],[50,54,58,62],[51,55,59,63]]}],"fragmentIndex":2},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"HyperShuffleConsumer","opName":"receive_r","argOperatorId":"shuffle_r"},{"opType":"HyperShuffleConsumer","opName":"receive_s","argOperatorId":"shuffle_s"},{"opType":"HyperShuffleConsumer","opName":"receive_t","argOperatorId":"shuffle_t"},{"opType":"InMemoryOrderBy","opName":"OrderR","argChild":"receive_r","argSortColumns":[0,1],"argAscending":[true,true]},{"opType":"InMemoryOrderBy","opName":"OrderS","argChild":"receive_s","argSortColumns":[0,1],"argAscending":[true,true]},{"opType":"InMemoryOrderBy","opName":"OrderT","argChild":"receive_t","argSortColumns":[1,0],"argAscending":[true,true]},{"opType":"LeapFrogJoin","opName":"Join","argChildren":["OrderR","OrderS","OrderT"],"argColumnNames":["x","y","z"],"indexOnFirst":[true,true,true],"joinFieldMapping":[[[0,0],[2,1]],[[0,1],[1,0]],[[1,1],[2,0]]],"outputFieldMapping":[[0,0],[1,0],[1,1]]},{"opType":"SinkRoot","opName":"SinkRoot","argChild":"Join","argLimit":null}],"fragmentIndex":3}],"profilingMode":true,"expectedResultSize":null,"ftMode":"none"},"submitTime":"2014-04-03T18:30:34.953-07:00","startTime":"2014-04-03T18:30:35.225-07:00","finishTime":"2014-04-03T18:31:40.373-07:00","message":null,"elapsedNanos":65147765848,"status":"SUCCESS","profilingMode":true};

    var tradPlan = {"url":"http://dbserver02.cs.washington.edu:10032/query/query-19","queryId":19,"rawQuery":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","logicalRa":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","physicalPlan":{"rawDatalog":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","logicalRa":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","fragments":[{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opName":"Scan(R)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"chushumo leapfrog twitter_10m\"          as a where a.follower<a.followee"},{"opType":"ShuffleProducer","opName":"Shuffle(R)","argChild":"Scan(R)","argPf":{"type":"SingleFieldHash","numPartitions":64,"index":1},"argBufferStateType":null}],"fragmentIndex":0},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opName":"Scan(S)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"chushumo leapfrog twitter_10m\""},{"opType":"ShuffleProducer","opName":"Shuffle(S)","argChild":"Scan(S)","argPf":{"type":"SingleFieldHash","numPartitions":64,"index":0},"argBufferStateType":null}],"fragmentIndex":1},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opName":"Scan(T)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"chushumo leapfrog twitter_10m\"          as a where a.follower>a.followee"},{"opType":"ShuffleProducer","opName":"Shuffle(T)","argChild":"Scan(T)","argPf":{"type":"MultiFieldHash","numPartitions":64,"indexes":[1,0]},"argBufferStateType":null}],"fragmentIndex":2},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"ShuffleConsumer","opName":"Receive(R)","argOperatorId":"Shuffle(R)"},{"opType":"ShuffleConsumer","opName":"Receive(S)","argOperatorId":"Shuffle(S)"},{"opType":"ShuffleConsumer","opName":"Receive(T)","argOperatorId":"Shuffle(T)"},{"opType":"SymmetricHashJoin","opName":"Join(R,S)","argChild1":"Receive(R)","argChild2":"Receive(S)","argColumnNames":["x","y","z"],"argColumns1":[1],"argColumns2":[0],"argSelect1":[0,1],"argSelect2":[1],"argSetSemanticsLeft":false,"argSetSemanticsRight":false},{"opType":"SymmetricHashJoin","opName":"Join(R,S,T)","argChild1":"Join(R,S)","argChild2":"Receive(T)","argColumnNames":null,"argColumns1":[0,2],"argColumns2":[0,1],"argSelect1":[0,1],"argSelect2":[1],"argSetSemanticsLeft":false,"argSetSemanticsRight":false},{"opType":"SinkRoot","opName":"SinkRoot","argChild":"Join(R,S,T)","argLimit":null}],"fragmentIndex":3}],"profilingMode":true,"expectedResultSize":null,"ftMode":"none"},"submitTime":"2014-04-03T23:24:43.628-07:00","startTime":null,"finishTime":null,"message":null,"elapsedNanos":null,"status":"ACCEPTED","profilingMode":true};


    </script>
    <script type="text/javascript" src="js/demo1.js" charset="utf-8" async defer></script>
{% endblock %}
