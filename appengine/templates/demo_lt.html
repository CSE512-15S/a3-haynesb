<!DOCTYPE html>
<html lang="en">
<head>
<title>Myria Web Frontend</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="css/layout.css" type="text/css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="css/queryvis.css">
<link rel="stylesheet" type="text/css" href="css/demo1.css">

</head>
<body data-spy="scroll" data-target="#scrollSpy">
    <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/"><img src="img/myria-logo.svg" height="40px" alt="Myria logo"></a>
            </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-md-10">
                <div class="row">
                    <h2 id="query" class="page-header"> Query Demo </h2>
                    <div class="col-md-5">
                        <div class="panel panel-default ">
                            <div class="panel-heading">
                                <h3 class="panel-title">Query</h3>
                            </div>
                            <div class="panel-body">
                                <p>
                                    <pre>Triangle(x,y,z) :- R(x,y), S(y,z), T(x,z)</pre>
                                </p>
                                <p>
                                    <strong>Meaning:</strong> Compute triangles in Twitter social graph.
                                </p>
                            </div>
                            <div class="panel-body">
                                <div class="btn-group dropup">
                                    <button type="button" id="plan-btn" class="planner btn btn-info">Compile to traditional plan</button>
                                    <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" title="Switch plan"><span class="caret"></span></button>
                                    <ul id="plan-menu" class="dropdown-menu" role="menu">
                                        <li><a class="changer">HyperCube plan</a></li>
                                    </ul>
                                    <button type="button" class="executor btn btn-primary"><span class="glyphicon glyphicon-play"></span> Execute</button>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Result</h3>
                            </div>
                            <div class="panel-body" id="status">
                                <pre id="executed"></pre>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7">
                        <div class="panel panel-default ">
                            <div class="panel-heading">
                                <h3 class="panel-title">Query Plan</h3>
                            </div >
                            <div class="panel-body">
                               <div class="query-plan panel-body"></div >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="spacer">
        <div id="footer">
            <div class="container">
                <p class="text-muted credit"><a href="http://myria.cs.washington.edu/">Myria Project</a> at the <a href="http://www.washington.edu/">University of Washington</a>, 2014</p>
            </div>
        </div>
    </div>

    <script src="js/jquery-2.1.0.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/d3.v3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/underscore-min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/d3.selection.popover.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/d3.selection.tooltip.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/graph.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/viz.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/queryvis.js" type="text/javascript" charset="utf-8"></script>

    <script type="text/javascript">
    {% autoescape false %}
        var myriaConnection = '{{ myriaConnection }}';
        var queryPlan = {{ queryPlan }};
    {% endautoescape %}

    var hyperCubePlan= {"rawQuery":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","logicalRa":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","physicalPlan":{"rawDatalog":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","logicalRa":"Result(x,y,z):=R(x,y),S(y,z),T(z,x)","fragments":[{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opId":"Scan(R)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"public adhoc twitter_1m\"          as a where a.follower<a.followee"},{"opType":"HyperShuffleProducer","opId":"shuffle_r","argChild":"Scan(R)","indexes":[0,1],"hyperCubeDimensions":[4,4,4],"cellPartition":[[0,1,2,3],[4,5,6,7],[8,9,10,11],[12,13,14,15],[16,17,18,19],[20,21,22,23],[24,25,26,27],[28,29,30,31],[32,33,34,35],[36,37,38,39],[40,41,42,43],[44,45,46,47],[48,49,50,51],[52,53,54,55],[56,57,58,59],[60,61,62,63]]}],"fragmentIndex":0},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opId":"Scan(S)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"public adhoc twitter_1m\""},{"opType":"HyperShuffleProducer","opId":"shuffle_s","argChild":"Scan(S)","indexes":[0,1],"hyperCubeDimensions":[4,4,4],"cellPartition":[[0,16,32,48],[1,17,33,49],[2,18,34,50],[3,19,35,51],[4,20,36,52],[5,21,37,53],[6,22,38,54],[7,23,39,55],[8,24,40,56],[9,25,41,57],[10,26,42,58],[11,27,43,59],[12,28,44,60],[13,29,45,61],[14,30,46,62],[15,31,47,63]]}],"fragmentIndex":1},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opId":"Scan(T)","schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"public adhoc twitter_1m\"          as a where a.follower>a.followee"},{"opType":"HyperShuffleProducer","opId":"shuffle_t","argChild":"Scan(T)","indexes":[1,0],"hyperCubeDimensions":[4,4,4],"cellPartition":[[0,4,8,12],[1,5,9,13],[2,6,10,14],[3,7,11,15],[16,20,24,28],[17,21,25,29],[18,22,26,30],[19,23,27,31],[32,36,40,44],[33,37,41,45],[34,38,42,46],[35,39,43,47],[48,52,56,60],[49,53,57,61],[50,54,58,62],[51,55,59,63]]}],"fragmentIndex":2},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"HyperShuffleConsumer","opId":"receive_r","argOperatorId":"shuffle_r"},{"opType":"HyperShuffleConsumer","opId":"receive_s","argOperatorId":"shuffle_s"},{"opType":"HyperShuffleConsumer","opId":"receive_t","argOperatorId":"shuffle_t"},{"opType":"InMemoryOrderBy","opId":"OrderR","argChild":"receive_r","argSortColumns":[0,1],"argAscending":[true,true]},{"opType":"InMemoryOrderBy","opId":"OrderS","argChild":"receive_s","argSortColumns":[0,1],"argAscending":[true,true]},{"opType":"InMemoryOrderBy","opId":"OrderT","argChild":"receive_t","argSortColumns":[1,0],"argAscending":[true,true]},{"opType":"LeapFrogJoin","opId":"Join","argChildren":["OrderR","OrderS","OrderT"],"argColumnNames":["x","y","z"],"indexOnFirst":[true,true,true],"joinFieldMapping":[[[0,0],[2,1]],[[0,1],[1,0]],[[1,1],[2,0]]],"outputFieldMapping":[[0,0],[1,0],[1,1]]},{"opType":"SinkRoot","opId":"SinkRoot","argChild":"Join","argLimit":null}],"fragmentIndex":3}],"profilingMode":true,"expectedResultSize":null,"ftMode":"none"}};

    var tradPlan = {"url":"http://dbserver02.cs.washington.edu:10032/query/query-191","queryId":191,"rawQuery":"E(x,y,z) :- S(x,y), R(y,z), T(z,x). ","logicalRa":"two step join ","physicalPlan":{"rawDatalog":"E(x,y,z) :- S(x,y), R(y,z), T(z,x). ","logicalRa":"two step join ","fragments":[{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opId":"Scan(R)","opName":null,"schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"public adhoc twitter_1m\" as a where a.follower<a.followee"},{"opType":"ShuffleProducer","opId":"Shuffle(R)","opName":null,"argChild":"Scan(R)","argPf":{"type":"SingleFieldHash","numPartitions":64,"index":1},"argBufferStateType":null}],"fragmentIndex":0},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opId":"Scan(S)","opName":null,"schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"public adhoc twitter_1m\""},{"opType":"ShuffleProducer","opId":"Shuffle(S)","opName":null,"argChild":"Scan(S)","argPf":{"type":"SingleFieldHash","numPartitions":64,"index":0},"argBufferStateType":null}],"fragmentIndex":1},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"ShuffleConsumer","opId":"GatherR","opName":null,"argOperatorId":"Shuffle(R)"},{"opType":"ShuffleConsumer","opId":"GatherS","opName":null,"argOperatorId":"Shuffle(S)"},{"opType":"SymmetricHashJoin","opId":"Join(R,S)","opName":null,"argChild1":"GatherR","argChild2":"GatherS","argColumnNames":["x","y","z"],"argColumns1":[1],"argColumns2":[0],"argSelect1":[0,1],"argSelect2":[1],"argSetSemanticsLeft":false,"argSetSemanticsRight":false},{"opType":"ShuffleProducer","opId":"Shuffle(R,S)","opName":null,"argChild":"Join(R,S)","argPf":{"type":"MultiFieldHash","numPartitions":64,"indexes":[0,2]},"argBufferStateType":null}],"fragmentIndex":2},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"DbQueryScan","opId":"Scan(T)","opName":null,"schema":{"columnTypes":["INT_TYPE","INT_TYPE"],"columnNames":["follower","followee"]},"sql":"select * from \"public adhoc twitter_1m\" as a where a.follower>a.followee"},{"opType":"ShuffleProducer","opId":"Shuffle(T)","opName":null,"argChild":"Scan(T)","argPf":{"type":"MultiFieldHash","numPartitions":64,"indexes":[1,0]},"argBufferStateType":null}],"fragmentIndex":3},{"workers":[40,22,49,12,31,20,6,27,55,62,19,34,13,41,48,5,33,28,18,42,47,25,61,56,46,7,53,26,36,45,8,35,63,54,17,2,9,51,44,37,58,64,16,10,52,43,30,23,15,38,29,1,57,24,21,14,60,3,32,39,11,4,50,59],"operators":[{"opType":"ShuffleConsumer","opId":"GatherRS","opName":null,"argOperatorId":"Shuffle(R,S)"},{"opType":"ShuffleConsumer","opId":"GatherT","opName":null,"argOperatorId":"Shuffle(T)"},{"opType":"SymmetricHashJoin","opId":"Join(R,S,T)","opName":null,"argChild1":"GatherRS","argChild2":"GatherT","argColumnNames":null,"argColumns1":[2,0],"argColumns2":[0,1],"argSelect1":[0,1],"argSelect2":[0],"argSetSemanticsLeft":false,"argSetSemanticsRight":false},{"opType":"SinkRoot","opId":"SinkRoot","opName":null,"argChild":"Join(R,S,T)","argLimit":null}],"fragmentIndex":4}],"profilingMode":true,"expectedResultSize":null,"ftMode":"none"},"profilingMode":true};

    </script>
    <script type="text/javascript" src="js/demo1.js" charset="utf-8" async defer></script>

</body>
</html>